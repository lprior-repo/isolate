{
  "active": true,
  "iteration": 9,
  "minIterations": 1,
  "maxIterations": 500,
  "completionPromise": "ALL BEADS COMPLETE - GRAPHITE STACKING IMPLEMENTED",
  "tasksMode": true,
  "taskPromise": "READY_FOR_NEXT_TASK",
  "prompt": "# Graphite-Style Stacked PR Implementation\n\n## Mission\n\nImplement 32 small beads to add Graphite-style stacked PR support to the zjj merge queue. Each bead must pass ATDD testing before merging to main.\n\n## Critical Workflow Per Bead\n\n**YOU MUST FOLLOW THIS EXACT WORKFLOW FOR EACH BEAD:**\n\n### Phase 1: SCOUT (Research)\n- Use `br show <bead-id>` to understand the bead requirements\n- Read ALL related files in the codebase\n- Identify patterns to follow from existing code\n- Document findings in `.ralph/scout-notes.md`\n\n### Phase 2: ATDD TEST DEFINITION (Subagent - HIDDEN)\n**CRITICAL: Use a SUBAGENT to define the test. The implementing agent MUST NOT see the test code until Phase 5.**\n\n```\nUse Task tool with subagent_type=\"functional-rust\" to:\n1. Read the bead requirements\n2. Define acceptance tests based on the EARS requirements and contracts\n3. Write tests to .ralph/atdd-tests/<bead-id>_test.rs\n4. The test file should compile but FAIL initially\n5. OUTPUT ONLY the file path - DO NOT show test contents\n```\n\n### Phase 3: RED (Write Failing Implementation Stub)\n- Create minimal implementation that makes the code compile\n- Run `cargo test` - tests MUST fail (this proves the test works)\n- If tests pass already, the test is wrong - go back to Phase 2\n\n### Phase 4: IMPLEMENT (Make Tests Pass)\n- Write the actual implementation\n- Follow existing patterns in the codebase\n- NO unwrap(), NO expect(), NO panic!()\n- Use Result/Option properly\n- Run `cargo test` frequently\n\n### Phase 5: REVIEW & ATDD VERIFICATION\n- Run the ATDD test from `.ralph/atdd-tests/<bead-id>_test.rs`\n- Run `cargo clippy -- -D warnings`\n- Run `cargo test --all`\n- If ANY failure: fix and repeat Phase 4-5\n- Only proceed when 100% clean\n\n### Phase 6: COMMIT\n- Commit with message referencing bead ID\n- Move to next bead\n\n## Bead Implementation Order\n\nImplement beads in this exact order (dependencies matter):\n\n### Phase A: Data Model (6 beads)\n```\nbd-1i1a  queue: Add parent_workspace column\nbd-3axf  queue: Add stack_depth column\nbd-umr4  queue: Add dependents JSON column\nbd-26kg  queue: Add stack_root column\nbd-1ued  queue-status: Add StackMergeState enum\nbd-36h8  queue: Add stack_merge_state column\n```\n\n### Phase B: Pure Helper Functions (5 beads)\n```\nbd-1ixz  stack: Add StackError enum\nbd-1idz  stack: Add calculate_stack_depth function\nbd-mmtr  stack: Add find_stack_root function\nbd-35xk  stack: Add validate_no_cycle function\nbd-i6lp  stack: Add build_dependent_list function\n```\n\n### Phase C: Repository Methods (5 beads)\n```\nbd-2ljz  queue: Add get_children method\nbd-38iz  queue: Add get_stack_root method\nbd-32u3  queue: Add find_blocked method\nbd-3vty  queue: Add update_dependents method\nbd-s6pj  queue: Add transition_stack_state method\n```\n\n### Phase D: Train Processor (4 beads)\n```\nbd-24yl  train: Filter blocked in next()\nbd-dqr8  train: Add stack_depth to sort\nbd-qbcr  train: Add cascade unblock logic\nbd-3cb2  train: Queue rebase for unblocked children\n```\n\n### Phase E: CLI Commands (8 beads)\n```\nbd-3mlc  cli: Add --parent flag parsing\nbd-170b  cli: Add parent validation\nbd-vak5  cli: Pass parent to repository\nbd-vz4z  cli: Add stack fields to submit JSONL\nbd-3dar  cli: Add stack error exit codes\nbd-29gt  cli: Add stack JSONL schema\nbd-1e5n  cli: Add stack status command\nbd-3p55  cli: Add stack sync command\n```\n\n### Phase F: Integration Tests (4 beads)\n```\nbd-2vew  test: Integration test stack submit\nbd-wx26  test: Integration test cascade merge\nbd-1has  test: Integration test stack priority\nbd-2wx8  test: Integration test deep stack\n```\n\n## Quality Gates (ALL must pass before next bead)\n\n```bash\n# 1. Tests pass\ncargo test --all\n\n# 2. No clippy warnings\ncargo clippy -- -D warnings\n\n# 3. Build clean\ncargo build --release\n\n# 4. ATDD test passes\ncargo test --test <bead-id>_test\n```\n\n## Code Standards\n\n- **NO unwrap()** - use `?` or pattern matching\n- **NO expect()** - use proper error types\n- **NO panic!()** - return Result\n- **All functions return Result<T, E>** for fallible operations\n- **Use thiserror for error types**\n- **Follow existing patterns in codebase**\n\n## File Locations\n\n- ATDD tests: `.ralph/atdd-tests/<bead-id>_test.rs`\n- Scout notes: `.ralph/scout-notes.md`\n- Progress tracking: `.ralph/progress.md`\n\n## Progress Tracking\n\nAfter each bead, update `.ralph/progress.md`:\n```markdown\n## Completed Beads\n- [x] bd-1i1a - queue: Add parent_workspace column (2026-02-21)\n- [ ] bd-3axf - queue: Add stack_depth column\n\n## Current Bead\nWorking on: bd-3axf\nPhase: 4 (IMPLEMENT)\n```\n\n## Completion Promise\n\nWhen ALL 32 beads are implemented and all quality gates pass, output:\n\n```\nALL BEADS COMPLETE - GRAPHITE STACKING IMPLEMENTED\n```\n\n## Important Notes\n\n1. **Read existing code first** - the codebase has patterns to follow\n2. **Small commits** - one commit per bead\n3. **Test first, always** - ATDD test defined before implementation\n4. **No shortcuts** - follow the 6-phase workflow exactly\n5. **100% clean** - no warnings, no failing tests, ever\n\n## Start Here\n\nBegin with bead `bd-1i1a` - \"queue: Add parent_workspace column\"\n\nRun: `br show bd-1i1a` to see the full specification.\n",
  "startedAt": "2026-02-21T21:13:17.056Z",
  "model": "zai-coding-plan/glm-5",
  "agent": "opencode"
}