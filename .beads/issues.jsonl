{"id":"zjj-162d","title":"Document P0 infrastructure architecture","description":"Document the medical-grade infrastructure built by 6 Opus agents:\n\nModules to document:\n1. workspace_state.rs - State machine for 40+ concurrent agents\n2. workspace_integrity.rs - Corruption detection/repair with zero data loss\n3. coordination/queue.rs - Sequential merge queue with priority ordering\n4. done/conflict.rs - Pre-merge conflict detection with JJ integration\n\nDocumentation needed:\n- Architecture diagrams (state transitions, queue flow, conflict detection)\n- Integration guide (how modules work together)\n- API documentation (public interfaces)\n- Design decisions (why Railway-Oriented Programming, why SQLite)\n- Testing strategy (unit vs integration tests)\n\nOutput: docs/P0-INFRASTRUCTURE.md","status":"open","priority":3,"issue_type":"docs","created_at":"2026-02-03T04:23:01.700658695Z","created_by":"lewis","updated_at":"2026-02-03T04:23:01.700658695Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"zjj-18v3","title":"zjj-context-aware-creation: Fix repo context detection","description":"# zjj-context-aware-creation: Fix repo context detection and targeting\n\n## Problem\nAgent 19 created zjj workspace in oya repo context instead of zjj repo. Need auto-detection based on bead metadata and explicit targeting.\n\n## Solution\nAdd `zjj add --repo=<path>` for explicit targeting. Auto-detect correct repo from bead metadata. Validate workspace is in correct repo.\n\n## Requirements\n\n### Ubiquitous\n- THE SYSTEM SHALL auto-detect target repo from bead metadata\n- THE SYSTEM SHALL support explicit repo targeting via --repo flag\n- THE SYSTEM SHALL validate workspace is created in correct repo\n\n### Event-Driven\n- WHEN `zjj add` is called, THE SYSTEM SHALL detect target repo\n- WHEN bead metadata specifies repo, THE SYSTEM SHALL use that repo\n- WHEN --repo flag is provided, THE SYSTEM SHALL override auto-detection\n- WHEN wrong repo is detected, THE SYSTEM SHALL error before creating workspace\n\n### Unwanted\n- IF repo context is wrong, THE SYSTEM SHALL NOT create workspace, BECAUSE wrong-repo work causes confusion\n- IF bead metadata is missing, THE SYSTEM SHALL NOT guess, BECAUSE explicit is better than implicit\n\n## Contracts\n\n### Preconditions\n- Target repo exists and is a valid git/jj repo\n- User has permissions in target repo\n- Bead metadata is accessible\n\n### Postconditions\n- Workspace created in correct repo\n- Metadata records target repo path\n- Error reported if repo mismatch\n\n### Invariants\n- Workspace directory is always under target repo\n- Repo validation happens before workspace creation\n- Repo path is absolute in metadata\n\n## Implementation\nAdd to zjj-core/src/commands/add.rs:\n- `--repo=<path>` flag\n- `detect_target_repo()` function reading bead metadata\n- Repo validation (check .git or .jj exists)\n- Error early if repo is wrong\n- Support for multi-repo beads with explicit targets\n\n## Acceptance Tests\n- Happy path: Auto-detect from bead metadata succeeds\n- Happy path: Explicit --repo flag works\n- Error path: Wrong repo detected, workspace not created\n- Edge case: Multi-repo bead with explicit targeting\n\n## Estimate\n2hr","status":"in_progress","priority":0,"issue_type":"feature","created_at":"2026-02-02T04:28:33.515870285Z","created_by":"lewis","updated_at":"2026-02-04T18:12:06.905110775Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"zjj-1ra8","title":"Add workspace_state to Session struct and DB schema","description":"workspace_state.rs is implemented (755 lines, 47 tests, state machine with 6 states) but not integrated into Session tracking.\n\nTasks:\n- Add workspace_state field to Session struct\n- Add state column to sessions table (SQLite migration)\n- Update Session::new() to initialize state = Created\n- Add state transitions in add/remove/done commands\n- Add --filter=<state> flag to list command\n- Track state history in state_transitions table\n\nDesign:\n- WorkspaceState enum: Created/Working/Ready/Merged/Abandoned/Conflict\n- Atomic state transitions with validation\n- Support for 40+ concurrent agents\n\nFiles:\n- crates/zjj-core/src/workspace_state.rs (implemented)\n- crates/zjj-core/src/types.rs (Session struct)\n- Need: DB migration, CLI integration","status":"in_progress","priority":2,"issue_type":"feature","created_at":"2026-02-03T04:22:50.792040675Z","created_by":"lewis","updated_at":"2026-02-04T18:35:16.664613391Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"zjj-1reo","title":"Integrate conflict detection into done command","description":"conflict.rs is implemented (684 lines) but not integrated into done command workflow.\n\nMissing:\n- conflict_detection field in DonePreview struct (done/types.rs)\n- Call run_conflict_detection() in done command when --detect-conflicts flag used\n- Wire up JSON output\n- Integration tests\n\nCurrent state: Module compiles but shows dead_code warnings\n\nFiles:\n- crates/zjj/src/commands/done/types.rs\n- crates/zjj/src/commands/done/mod.rs\n- crates/zjj/src/commands/done/conflict.rs (implemented)","status":"open","priority":2,"issue_type":"feature","created_at":"2026-02-03T04:22:40.676749028Z","created_by":"lewis","updated_at":"2026-02-03T04:22:40.676749028Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"zjj-1ven","title":"zjj-merge-queue: Sequential merge coordination","description":"# zjj-merge-queue: Implement sequential merge coordination\n\n## Problem\n40 agents trying to merge simultaneously causes conflict chaos. Need queue system for sequential merging to prevent parallel merge disasters.\n\n## Solution\nAdd merge queue: `zjj queue add`, `zjj queue list`, `zjj queue process`.\nAuto-queue on conflict detection instead of failing.\n\n## Requirements\n\n### Ubiquitous\n- THE SYSTEM SHALL maintain a merge queue with priority ordering\n- THE SYSTEM SHALL process merges sequentially\n- THE SYSTEM SHALL auto-queue conflicted merges\n\n### Event-Driven\n- WHEN user runs `zjj queue add <workspace>`, THE SYSTEM SHALL add to queue\n- WHEN `zjj done` detects conflict, THE SYSTEM SHALL auto-add to queue\n- WHEN `zjj queue process` is run, THE SYSTEM SHALL process queue in order\n- WHEN merge succeeds, THE SYSTEM SHALL remove from queue and process next\n\n### Unwanted\n- IF queue is processing, THE SYSTEM SHALL NOT allow parallel merges, BECAUSE sequential is the goal\n- IF merge fails, THE SYSTEM SHALL NOT retry automatically, BECAUSE manual intervention may be needed\n\n## Contracts\n\n### Preconditions\n- Queue storage is available\n- Workspaces in queue exist\n- Main branch is accessible\n\n### Postconditions\n- Queue persisted to disk\n- Processed merges removed from queue\n- Failed merges marked with reason\n\n### Invariants\n- Queue order is deterministic (priority, then FIFO)\n- Only one merge processes at a time\n- Queue state is consistent across crashes\n\n## Implementation\nAdd to zjj-core/src/:\n- `queue.rs` - Queue data structure with priority\n- `queue/add.rs` - Add workspace to queue\n- `queue/list.rs` - Show pending merges\n- `queue/process.rs` - Process queue sequentially\n- `queue/priority.rs` - Set merge priority\n- Queue storage in zjj metadata (JSON)\n- Lock mechanism to prevent parallel processing\n- Integration with `zjj done` for auto-queueing\n\n## Acceptance Tests\n- Happy path: Add to queue, process sequentially, merges succeed\n- Error path: Conflict detected, auto-queued, manual resolution needed\n- Edge case: Priority overrides FIFO order\n- Edge case: Queue processing interrupted and resumed\n\n## Estimate\n4hr","notes":"Core queue implementation complete (queue.rs). CLI commands and integration pending - see GitHub issue #10","status":"in_progress","priority":0,"issue_type":"feature","created_at":"2026-02-02T04:29:07.101562403Z","created_by":"lewis","updated_at":"2026-02-03T02:54:40.632876952Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"zjj-2gvj","title":"Implement cmd_queue CLI command","description":"The merge queue infrastructure is implemented (coordination/queue.rs with 542 lines, SQLite backend, 11 tests passing) but not wired up to CLI.\n\nCurrent state: main.rs:2055 has commented out .subcommand(cmd_queue())\n\nTasks:\n- Create cmd_queue() function in main.rs\n- Add CLI flags: --add, --list, --next, --remove, --status, --stats\n- Wire up to MergeQueue API\n- Support JSON output\n- Add integration tests\n\nFiles:\n- crates/zjj/src/main.rs\n- crates/zjj-core/src/coordination/queue.rs (already implemented)","status":"open","priority":2,"issue_type":"feature","created_at":"2026-02-03T04:22:37.370979151Z","created_by":"lewis","updated_at":"2026-02-03T04:22:37.370979151Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"zjj-2zjx","title":"P3: Enhanced TUI dashboard with kanban and drag-drop","description":"## Vision\nzjj dashboard becomes the command center - full TUI for all workspace operations.\n\n## EARS Requirements\n\n### Ubiquitous Requirements\n- **[U1]** The system shall provide enhanced kanban board view\n- **[U2]** The system shall support inline session creation\n- **[U3]** The system shall allow drag-drop status changes\n- **[U4]** The system shall show real-time updates\n\n### Event-Driven Requirements\n- **[E1]** When user presses 'n', create new session dialog appears\n- **[E2]** When user drags session to 'completed', status updates\n- **[E3]** When external changes occur, dashboard refreshes\n\n### Optional Feature Requirements\n- **[O1]** Where --minimal provided, show compact view\n- **[O2]** Where --filter=<status> provided, filter displayed sessions\n\n## Edge Cases\n1. Terminal resize - Responsive layout\n2. Very many sessions - Scrolling/pagination\n3. Slow database - Loading indicators\n4. Keyboard-only navigation - Full accessibility\n\n## E2E Test: test_dashboard_enhanced\n```\nGIVEN 10 sessions in various states\nWHEN user opens 'zjj dashboard'\nTHEN kanban columns shown for: creating, active, paused, completed\nAND session cards are draggable\nAND 'n' key opens new session dialog\nAND 'q' quits cleanly\n```","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-19T04:40:35.587579815Z","created_by":"lewis","updated_at":"2026-01-19T05:07:33.016530768Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"zjj-350l","title":"Fix test harness workspace path configuration","description":"Test harness in tests/common/mod.rs assumes workspaces are in repo root, but config creates them in {repo}__workspaces. Update TestHarness::new() to create .zjj/config.toml with workspace_dir = \".\" or update workspace_path() to compute correct path from config.\n\nRoot cause: Design smell - test setup doesn't match production config.\nAffects: 11 failing tests (session lifecycle, conflict detection, spawn)","status":"in_progress","priority":1,"issue_type":"bug","created_at":"2026-02-03T04:22:17.511008279Z","created_by":"lewis","updated_at":"2026-02-04T14:30:06.653618035Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"zjj-3bfs","title":"Fix 7 session lifecycle integration tests","description":"Tests failing due to workspace path mismatch:\n- test_add_session_creates_workspace_directory\n- test_add_creates_jj_workspace  \n- test_add_creates_session\n- test_remove_deletes_session\n- test_complete_session_lifecycle\n\nBlocked by: zjj-350l\n\nDesign improvements needed:\n- Better separation between test fixtures and production code\n- Dependency injection for filesystem paths\n- Clearer workspace location contracts","status":"blocked","priority":1,"issue_type":"bug","created_at":"2026-02-03T04:22:25.153928168Z","created_by":"lewis","updated_at":"2026-02-03T04:22:25.153928168Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"zjj-3c6p","title":"Fix 2 conflict detection integration tests","description":"Tests failing due to workspace path issues:\n- test_detect_conflicts_no_conflicts_succeeds\n- test_detect_conflicts_found_reports_details\n\nBlocked by: zjj-350l\n\nThe conflict.rs module is implemented (684 lines, 18 unit tests passing) but integration tests fail due to test harness setup.","notes":"Fixed multiple compilation errors blocking tests:\n- batch/mod.rs syntax errors (misplaced ?)\n- execute_command lifetime issues  \n- Cow<str> type mismatches\n- assert!(false) → panic!() conversions\n\nTests still cannot run due to zjj-350l blocker (test harness config).\nRemaining work: ~19 clippy errors in test code still block compilation.","status":"in_progress","priority":1,"issue_type":"bug","created_at":"2026-02-03T04:22:27.136537740Z","created_by":"lewis","updated_at":"2026-02-04T18:17:31.714870502Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"zjj-3hea","title":"Fix 4 spawn behavior edge case tests","description":"Tests failing in spawn_behavior_tests.rs:\n- given_spawn_when_agent_runs_then_env_vars_set\n- given_agent_exits_nonzero_when_spawn_then_handled_gracefully\n- given_agent_command_not_found_when_spawn_then_clear_error\n- given_two_spawns_same_bead_when_racing_then_one_succeeds\n\nBlocked by: zjj-350l\n\nDesign smells:\n- Tests depend on filesystem state\n- Unclear error handling contracts\n- Race conditions in concurrent spawn tests","status":"blocked","priority":2,"issue_type":"bug","created_at":"2026-02-03T04:22:31.057600742Z","created_by":"lewis","updated_at":"2026-02-03T04:22:31.057600742Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"zjj-3n0h","title":"zjj-automatic-cleanup: Orphaned workspace cleanup","description":"# zjj-automatic-cleanup: Implement orphaned workspace cleanup\n\n## Problem\nFailed agents leave orphaned workspaces. Need automatic detection and cleanup of merged/abandoned workspaces.\n\n## Solution\nAdd `zjj clean --auto`, `zjj clean --age=<duration>`, `zjj clean --dry-run`.\nIntegrate with WorkspaceGuard Drop trait.\n\n## Requirements\n\n### Ubiquitous\n- THE SYSTEM SHALL detect orphaned (merged or abandoned) workspaces\n- THE SYSTEM SHALL clean workspaces older than specified age\n- THE SYSTEM SHALL preview cleanup with dry-run mode\n\n### Event-Driven\n- WHEN user runs `zjj clean --auto`, THE SYSTEM SHALL detect and clean orphans\n- WHEN `--age` is specified, THE SYSTEM SHALL only clean old workspaces\n- WHEN `--dry-run` is used, THE SYSTEM SHALL show what would be cleaned without changes\n\n### Unwanted\n- IF workspace has uncommitted work, THE SYSTEM SHALL NOT clean, BECAUSE data loss is unacceptable\n- IF cleanup would be destructive, THE SYSTEM SHALL NOT proceed without confirmation, BECAUSE safety first\n\n## Contracts\n\n### Preconditions\n- Workspace metadata is accessible\n- User has permissions to delete directories\n- WorkspaceGuard Drop trait is implemented\n\n### Postconditions\n- Orphaned workspaces removed from disk\n- Metadata updated to reflect cleanup\n- Audit log records cleanup actions\n\n### Invariants\n- Active workspaces never cleaned\n- Cleanup requires confirmation for non-dry-run\n- WorkspaceGuard cleanup always runs on Drop\n\n## Implementation\nAdd to zjj-core/src/commands/clean.rs:\n- `--auto` flag for automatic detection\n- `--age=<duration>` flag for age-based cleanup\n- `--dry-run` flag for preview\n- Orphan detection: check state is \"merged\" or older than age\n- Safety checks: uncommitted work, active processes\n- Integration with WorkspaceGuard Drop\n- Confirmation prompt for destructive actions\n\n## Acceptance Tests\n- Happy path: Orphaned workspaces cleaned successfully\n- Error path: Active workspace not cleaned\n- Edge case: Dry-run shows preview without changes\n- Edge case: Age filter only cleans old workspaces\n\n## Estimate\n2hr","status":"in_progress","priority":0,"issue_type":"feature","created_at":"2026-02-02T04:29:37.321638840Z","created_by":"lewis","updated_at":"2026-02-03T02:22:18.258774903Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"zjj-41es","title":"P3: Add pane resize support","description":"## Vision\nPane resizing through zjj - no need for 'zellij action resize'.\n\n## EARS Requirements\n\n### Ubiquitous Requirements\n- **[U1]** The system shall provide 'zjj pane resize <session> <direction> [amount]'\n- **[U2]** Directions: up, down, left, right, increase, decrease\n- **[U3]** The system shall support --json flag\n\n### Event-Driven Requirements\n- **[E1]** When 'zjj pane resize work left 10' runs, resize pane left by 10\n- **[E2]** When amount omitted, use default (5)\n\n### Optional Feature Requirements\n- **[O1]** Where --pane=<name> provided, resize specific pane\n- **[O2]** Where --percent provided, interpret amount as percentage\n\n## Edge Cases\n1. Cannot resize further - Hit boundary, exit 0\n2. Invalid direction - Validation error\n3. Negative amount - Resize opposite direction\n4. Very large amount - Clamp to max\n\n## E2E Test: test_pane_resize\n```\nGIVEN session 'work' with resizable panes\nWHEN 'zjj pane resize work left 10 --json'\nTHEN return {success: true, direction: 'left', amount: 10}\n```","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-19T04:40:40.185731931Z","created_by":"lewis","updated_at":"2026-01-19T05:07:33.480361452Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"zjj-445v","title":"Scaffold Workflow and Tooling Documentation","description":"CONTEXT: Agents need to understand the workspace workflow and tool integration.\nGOAL: Expand 'zjj init' to scaffold docs/03_WORKFLOW.md, docs/08_BEADS.md, and docs/09_JUJUTSU.md.\nEARS: When 'zjj init' is invoked, the system shall populate docs/ with workflow and tooling templates.\nACCEPTANCE:\n1. docs/03_WORKFLOW.md (zjj workflow) created.\n2. docs/08_BEADS.md (beads integration) created.\n3. docs/09_JUJUTSU.md (jj workspaces) created.","status":"open","priority":2,"issue_type":"task","owner":"priorlewis43@gmail.com","created_at":"2026-01-29T10:26:01.951785036Z","created_by":"Lewis Prior","updated_at":"2026-01-29T10:26:01.951785036Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["docs","init","scaffold"]}
{"id":"zjj-4v9w","title":"P3: Add floating pane toggle","description":"## Vision\nFloating pane toggle through zjj - no need for 'zellij action toggle-floating'.\n\n## EARS Requirements\n\n### Ubiquitous Requirements\n- **[U1]** The system shall provide 'zjj pane float [session]'\n- **[U2]** The system shall toggle floating mode on current pane\n- **[U3]** The system shall support --json flag\n\n### Event-Driven Requirements\n- **[E1]** When 'zjj pane float' runs, toggle floating\n- **[E2]** When already floating, unfloat\n\n### Optional Feature Requirements\n- **[O1]** Where --on provided, force floating on\n- **[O2]** Where --off provided, force floating off\n\n## Edge Cases\n1. Already in desired state - No-op success\n2. Multiple floating panes - Toggle current only\n3. Not inside session - Error\n\n## E2E Test: test_pane_float\n```\nGIVEN session 'work' with embedded pane\nWHEN 'zjj pane float work --json'\nTHEN pane becomes floating\nAND return {success: true, floating: true}\nWHEN 'zjj pane float work --json' again\nTHEN return {success: true, floating: false}\n```","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-19T04:40:43.613070026Z","created_by":"lewis","updated_at":"2026-01-19T05:07:36.659047286Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"zjj-4xvj","title":"Wire up workspace_integrity module to validation flow","description":"workspace_integrity.rs is fully implemented (2043 lines, 53 tests, zero panics) but not integrated into main validation flow.\n\nModule provides:\n- Corruption detection (9 types)\n- Repair strategies with backup/rollback\n- BackupManager with cleanup\n- RepairExecutor\n\nIntegration needed:\n- Call from zjj doctor command\n- Call before risky operations (workspace forget, recreate)\n- Expose via CLI flags: --validate, --repair, --backup, --rollback\n- Add to pre-merge validation\n\nFiles:\n- crates/zjj-core/src/workspace_integrity.rs (implemented)\n- Need: CLI command integration","status":"open","priority":2,"issue_type":"feature","created_at":"2026-02-03T04:22:46.438698986Z","created_by":"lewis","updated_at":"2026-02-03T04:22:46.438698986Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"zjj-6jbc","title":"Broadcast Command Implementation","description":"> CONTEXT BLOCK:\n> - **File/Function:** `crates/zjj/src/commands/broadcast/mod.rs` (NEW)\n> - **The Smell:** \"No inter-agent messaging. Agents can't coordinate or notify each other.\"\n\n> SPECIFICATION BLOCK:\n> 1. **EARS:**\n>     - When broadcast runs, system shall send message to all active agents except sender.\n>     - When storing message, system shall record timestamp and sender agent_id.\n>     - When retrieving messages, agents shall see only unread messages for them.\n> 2. **DbC:**\n>     - **Preconditions:** Agent registry has active agents\n>     - **Postconditions:** Message stored, sent_to list includes all active agents except sender\n> 3. **TDD:**\n>     - test_broadcast_sends_to_all_active\n>     - test_sender_not_in_sent_to_list\n>     - test_message_timestamp_recorded\n> 4. **Design by Type:**\n>     ```rust\n>     pub async fn run(args: BroadcastArgs) -> Result<BroadcastResponse> {\n>         let active_agents = agent_registry.get_active().await?;\n>         let sent_to: Vec<String> = active_agents.iter().filter(|a| a.id \\!= args.agent_id).map(|a| a.id.clone()).collect();\n>         broadcast_mgr.send(&args.message, &args.agent_id, &sent_to).await?;\n>         Ok(BroadcastResponse { success: true, message: args.message, sent_to, timestamp: Utc::now().to_rfc3339() })\n>     }\n>     ```\n> 5. **Schema & Edge Cases:** No other agents → sent_to is empty\n> 6. **Invariants/Variants:**\n>     - **WILL DO:** Send to active agents only, exclude sender\n>     - **WON'T DO:** Won't support direct messages (only broadcast), won't persist messages long-term\n> 7. **Review as AI:**\n>     - **Coverage:** Inter-agent messaging\n>     - **Context:** Depends on AgentRegistry (zjj-mitf)","status":"in_progress","priority":2,"issue_type":"task","owner":"priorlewis43@gmail.com","created_at":"2026-01-25T07:21:31.764665688Z","created_by":"Lewis Prior","updated_at":"2026-02-04T18:11:28.916237931Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"zjj-6jbc","depends_on_id":"zjj-mitf","type":"blocks","created_at":"2026-02-02T04:20:03Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"zjj-7qzd","title":"P3: Multi-repository workspace support","description":"## Vision\nManage workspaces across multiple repositories from single zjj instance.\n\n## EARS Requirements\n\n### Ubiquitous Requirements\n- **[U1]** The system shall support 'zjj repo add <path>' to register repositories\n- **[U2]** The system shall namespace sessions by repository\n- **[U3]** The system shall support cross-repo session listing\n\n### Event-Driven Requirements\n- **[E1]** When 'zjj list --all-repos' runs, show sessions from all repos\n- **[E2]** When 'zjj add' runs, use current repo or --repo flag\n\n### Optional Feature Requirements\n- **[O1]** Where --repo=<name> provided, target specific repository\n- **[O2]** Where --global provided on config, apply to all repos\n\n## Edge Cases\n1. Repo path changes - Update registry\n2. Repo deleted - Clean removal\n3. Same session name in different repos - Namespacing\n4. Network-mounted repos - Performance\n\n## E2E Test: test_multi_repo\n```\nGIVEN repo-a and repo-b both initialized with zjj\nWHEN 'zjj repo add ../repo-b' from repo-a\nAND 'zjj list --all-repos --json'\nTHEN return sessions from both repos with repo prefix\n```","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-19T04:40:47.331385566Z","created_by":"lewis","updated_at":"2026-01-23T07:20:18.635068755Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"zjj-d1je","title":"P2: Implement parallel test runner across workspaces","description":"## Vision\nRun tests across all workspaces in parallel - verify all work is passing.\n\n## EARS Requirements\n\n### Ubiquitous Requirements\n- **[U1]** The system shall provide 'zjj test [session...]' command\n- **[U2]** The system shall run tests in workspace directories\n- **[U3]** The system shall aggregate results across sessions\n- **[U4]** The system shall support --json for output\n\n### Event-Driven Requirements\n- **[E1]** When 'zjj test --all' runs, test all active sessions\n- **[E2]** When 'zjj test ws-1 ws-2' runs, test specific sessions\n- **[E3]** When any test fails, report with session context\n- **[E4]** When all pass, show success summary\n\n### State-Driven Requirements\n- **[S1]** While testing, show progress per session\n- **[S2]** While test is running, allow Ctrl+C to cancel all\n\n### Optional Feature Requirements\n- **[O1]** Where --command=<cmd> provided, use custom test command\n- **[O2]** Where --parallel provided, run tests concurrently\n- **[O3]** Where --fail-fast provided, stop on first failure\n- **[O4]** Where --coverage provided, collect coverage data\n\n### Unwanted Behavior Requirements\n- **[IF1]** If no test command found, try: moon run :test, cargo test, npm test\n- **[IF2]** If session has no testable code, skip with warning\n\n## Edge Cases\n1. Mixed test frameworks - Detect per workspace\n2. Tests require build first - Chain with build step\n3. Tests hang - Respect timeout\n4. Very long test output - Truncate with option for full\n\n## E2E Test: test_parallel_runner\n```\nGIVEN sessions ws-1, ws-2 both with passing tests\nWHEN 'zjj test --all --parallel --json'\nTHEN return {\n  success: true,\n  results: [\n    {session: 'ws-1', passed: 15, failed: 0, duration_ms: 1234},\n    {session: 'ws-2', passed: 8, failed: 0, duration_ms: 567}\n  ]\n}\n```","status":"in_progress","priority":2,"issue_type":"feature","created_at":"2026-01-19T05:10:22.202655844Z","created_by":"lewis","updated_at":"2026-02-02T04:20:22.139543470Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"zjj-ne2b","title":"P3: Interactive conflict resolution UI","description":"## Vision\nConflict resolution through zjj - no need to know JJ conflict commands.\n\n## EARS Requirements\n\n### Ubiquitous Requirements\n- **[U1]** The system shall provide 'zjj resolve [session]' for conflict resolution\n- **[U2]** The system shall show interactive TUI for conflict markers\n- **[U3]** The system shall support --json for programmatic conflict listing\n\n### Event-Driven Requirements\n- **[E1]** When 'zjj resolve' runs, show conflicted files list\n- **[E2]** When user selects file, show side-by-side diff with markers\n- **[E3]** When user resolves conflict, mark file as resolved\n\n### Optional Feature Requirements\n- **[O1]** Where --theirs provided, auto-resolve taking theirs\n- **[O2]** Where --ours provided, auto-resolve taking ours\n- **[O3]** Where --tool=<editor> provided, open in external tool\n\n## Edge Cases\n1. No conflicts - Exit 0 with message\n2. Binary file conflicts - Special handling\n3. Very large files - Streaming/pagination\n4. Nested conflicts - Handle properly\n\n## E2E Test: test_resolve_workflow\n```\nGIVEN session 'conflict-session' with conflicted file 'src/main.rs'\nWHEN 'zjj resolve conflict-session --list --json'\nTHEN return {conflicts: [{file: 'src/main.rs', markers: 3}]}\nWHEN user interactively resolves in TUI\nTHEN jj squash called to complete resolution\n```","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-19T04:40:39.057238826Z","created_by":"lewis","updated_at":"2026-01-23T07:20:23.699959175Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"zjj-nye9","title":"Lock Command Implementation","description":"> CONTEXT BLOCK:\n> - **File/Function:** `crates/zjj/src/commands/lock/mod.rs` (NEW)\n> - **The Smell:** \"No lock/unlock commands. Multi-agent conflicts possible. No exclusive session access.\"\n\n> SPECIFICATION BLOCK:\n> 1. **EARS:**\n>     - When lock runs, system shall acquire exclusive lock on session for agent_id.\n>     - When unlock runs, system shall release lock if held by requesting agent.\n>     - When lock is held by another agent, system shall return SESSION_LOCKED error with holder info.\n> 2. **DbC:**\n>     - **Preconditions:** Session exists, agent is registered\n>     - **Postconditions:** Lock acquired (or error if held), lock released (or error if not holder)\n> 3. **TDD:**\n>     - test_lock_acquires_successfully\n>     - test_lock_fails_if_held_by_another\n>     - test_unlock_releases_successfully\n>     - test_unlock_fails_if_not_holder\n>     - test_expired_lock_can_be_reacquired\n> 4. **Design by Type:**\n>     ```rust\n>     pub async fn run(args: LockArgs) -> Result<LockResponse> {\n>         match args.action {\n>             LockAction::Lock => {\n>                 let lock_info = lock_mgr.lock(&args.session, &args.agent_id).await?;\n>                 Ok(LockResponse { success: true, session: args.session, locked: true, lock_id: lock_info.lock_id, holder: args.agent_id, expires_at: lock_info.expires_at })\n>             }\n>             LockAction::Unlock => {\n>                 lock_mgr.unlock(&args.session, &args.agent_id).await?;\n>                 Ok(LockResponse { success: true, session: args.session, locked: false, lock_id: String::new(), holder: String::new(), expires_at: None })\n>             }\n>         }\n>     }\n>     ```\n> 5. **Schema & Edge Cases:** Lock held by another → error with fixes, expired lock → auto-reacquire\n> 6. **Invariants/Variants:**\n>     - **WILL DO:** TTL on locks, auto-expire stale locks\n>     - **WON'T DO:** Won't allow force-unlock by non-holder, won't support shared locks\n> 7. **Review as AI:**\n>     - **Coverage:** Session locking for multi-agent coordination\n>     - **Context:** Depends on LockManager (zjj-i9u5)","notes":"Session: implementing via tdd15 workflow","status":"in_progress","priority":1,"issue_type":"task","owner":"priorlewis43@gmail.com","created_at":"2026-01-25T07:21:29.359028686Z","created_by":"Lewis Prior","updated_at":"2026-02-04T16:15:37.437173434Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"zjj-nye9","depends_on_id":"zjj-i9u5","type":"blocks","created_at":"2026-02-02T04:20:04Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"zjj-nzhd","title":"P2: Add tab rename support via Zellij integration","description":"## Vision\nzjj wraps Zellij completely - AI agents use 'zjj rename' not 'zellij action rename-tab'. Single tool interface.\n\n## EARS Requirements\n\n### Ubiquitous Requirements\n- **[U1]** The system shall provide 'zjj rename <session> <new-tab-name>' for tab renaming\n- **[U2]** The system shall update both Zellij tab and database record\n- **[U3]** The system shall support --json flag\n\n### Event-Driven Requirements\n- **[E1]** When 'zjj rename <session> <name>' runs, rename Zellij tab\n- **[E2]** When rename succeeds, update session.zellij_tab in database\n\n### Optional Feature Requirements\n- **[O1]** Where --prefix-only provided, only change prefix (keep zjj: format)\n\n### Unwanted Behavior Requirements\n- **[IF1]** If session doesn't exist, exit 3\n- **[IF2]** If not inside Zellij, exit 2 with message\n- **[IF3]** If name too long, exit 1 with validation error\n\n## Edge Cases\n1. Rename to same name - No-op success\n2. Rename while session is focused - Should work\n3. Special characters in name - Validate/escape\n4. Rename non-existent tab - Tab was closed externally\n\n## E2E Test: test_rename_workflow\n```\nGIVEN session 'my-session' with tab 'zjj:my-session'\nWHEN 'zjj rename my-session \"Feature Work\" --json'\nTHEN Zellij tab renamed to 'Feature Work'\nAND return {success: true, old_name: 'zjj:my-session', new_name: 'Feature Work'}\nAND zjj status shows new tab name\n```","status":"in_progress","priority":2,"issue_type":"feature","created_at":"2026-01-19T04:40:43.133811968Z","created_by":"lewis","updated_at":"2026-02-02T04:20:24.994852598Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"zjj-r1gq","title":"P2: Expose 'jj op restore' for session recovery","description":"## Vision\nzjj wraps JJ completely - AI agents use 'zjj recover' not 'jj op restore'. Single tool interface.\n\n## EARS Requirements\n\n### Ubiquitous Requirements\n- **[U1]** The system shall provide 'zjj recover [session]' to restore from operation log\n- **[U2]** The system shall list recent operations if no operation ID given\n- **[U3]** The system shall support --json flag\n\n### Event-Driven Requirements\n- **[E1]** When 'zjj recover <session>' runs, show recent operations to choose from\n- **[E2]** When 'zjj recover <session> --op=<id>' runs, restore to that operation\n- **[E3]** When recovery succeeds, emit confirmation with state summary\n\n### Optional Feature Requirements\n- **[O1]** Where --list provided, show operation log without recovering\n- **[O2]** Where --last provided, recover to previous operation (undo last)\n\n### Unwanted Behavior Requirements\n- **[IF1]** If operation ID invalid, exit 1 with valid operations list\n- **[IF2]** If session doesn't exist, exit 3\n\n## Edge Cases\n1. Recover to current state - No-op, success\n2. Very old operation - May not exist, clear error\n3. Operation that created session - Special handling\n4. Concurrent recovery attempts - Lock properly\n\n## E2E Test: test_recover_workflow\n```\nGIVEN session 'oops' where user just ran bad rebase\nWHEN 'zjj recover oops --list --json'\nTHEN return {operations: [{id: 'abc', description: 'rebase', timestamp: ...}, ...]}\nWHEN 'zjj recover oops --last --json'\nTHEN return {success: true, restored_to: 'previous_op_id', session: 'oops'}\n```","status":"in_progress","priority":2,"issue_type":"feature","created_at":"2026-01-19T04:40:44.011988587Z","created_by":"lewis","updated_at":"2026-02-04T18:23:50.283375236Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"zjj-r2yx","title":"zjj-workspace-lifecycle-tracking: Workspace state machine","description":"# zjj-workspace-lifecycle-tracking: Implement workspace state machine and tracking\n\n## Problem\nWith 40 agents creating workspaces, no visibility into which are active, merged, abandoned, or conflicted. Need comprehensive workspace lifecycle tracking.\n\n## Solution\nImplement state machine: created → working → ready → merged/abandoned/conflict\nAdd `zjj status --all` and `zjj list --filter=<state>` for workspace visibility.\n\n## Requirements\n\n### Ubiquitous\n- THE SYSTEM SHALL track workspace state in zjj metadata\n- THE SYSTEM SHALL support filtering workspaces by state\n- THE SYSTEM SHALL show all workspaces across sessions\n\n### Event-Driven\n- WHEN workspace is created, THE SYSTEM SHALL mark state as \"created\"\n- WHEN first commit is made, THE SYSTEM SHALL transition to \"working\"\n- WHEN `zjj done` is called, THE SYSTEM SHALL transition to \"ready\"\n- WHEN merge completes, THE SYSTEM SHALL transition to \"merged\"\n- WHEN conflict detected, THE SYSTEM SHALL transition to \"conflict\"\n\n### Unwanted\n- IF state transition is invalid, THE SYSTEM SHALL NOT proceed, BECAUSE state machine must be enforced\n- IF metadata is missing, THE SYSTEM SHALL NOT fail, BECAUSE graceful degradation is needed\n\n## Contracts\n\n### Preconditions\n- zjj metadata directory exists\n- State file is writable\n\n### Postconditions\n- All workspaces have valid state\n- State transitions are logged\n- Filters work correctly\n\n### Invariants\n- State transitions are one-way (except conflict → working via repair)\n- State is persisted before transition completes\n- State file is always valid JSON\n\n## Implementation\nAdd to zjj-core/src/:\n- `state.rs` - State machine implementation\n- `metadata.rs` - Workspace metadata storage (JSON)\n- Update commands to record state transitions\n- Add `status --all` flag\n- Add `list --filter=state` flag\n- State transition validation\n\n## Acceptance Tests\n- Happy path: Workspace transitions through all states correctly\n- Error path: Invalid transition rejected\n- Edge case: Missing metadata handled gracefully\n- Edge case: Filter with multiple states\n\n## Estimate\n4hr","status":"in_progress","priority":0,"issue_type":"feature","created_at":"2026-02-02T04:28:06.723716781Z","created_by":"lewis","updated_at":"2026-02-03T02:22:37.324869191Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"zjj-rmjy","title":"P2: Implement template management commands","description":"## Vision\nzjj is the single interface for AI agents - no need to learn JJ or Zellij separately. Template management enables custom layouts without touching Zellij directly.\n\n## EARS Requirements\n\n### Ubiquitous Requirements\n- **[U1]** The system shall provide 'zjj template' subcommand for layout management\n- **[U2]** The system shall support: list, create, use, delete, show operations\n- **[U3]** The system shall store templates in .zjj/templates/ directory\n- **[U4]** The system shall support --json flag for all operations\n\n### Event-Driven Requirements\n- **[E1]** When 'zjj template list' runs, the system shall show all available templates with metadata\n- **[E2]** When 'zjj template create <name>' runs, the system shall save current session layout as template\n- **[E3]** When 'zjj template create <name> --from-file=<kdl>' runs, the system shall import external KDL\n- **[E4]** When 'zjj template use <name>' runs in a session, the system shall apply that layout\n- **[E5]** When 'zjj template delete <name>' runs, the system shall remove template (with confirmation)\n\n### State-Driven Requirements\n- **[S1]** While in a session, 'zjj template create --from-current' shall capture live layout\n- **[S2]** While template is in use by sessions, delete shall warn but allow with --force\n\n### Optional Feature Requirements\n- **[O1]** Where --set-default flag is provided, new sessions shall use this template\n- **[O2]** Where --export flag is provided, template shall be written to stdout as KDL\n- **[O3]** Where --dry-run flag is provided on 'use', system shall preview without applying\n\n### Unwanted Behavior Requirements\n- **[IF1]** If template name contains invalid characters, then exit 1 with validation error\n- **[IF2]** If template doesn't exist on 'use', then exit 3 with available templates list\n- **[IF3]** If create would overwrite existing, then require --force flag\n\n## Edge Cases\n1. **Built-in templates (minimal, standard, full, split, review)** - Cannot delete, can copy\n2. **Template with external dependencies** - Validate pane commands exist\n3. **Very large template** - Handle memory gracefully\n4. **Template created on different OS** - Path normalization\n5. **Concurrent template operations** - File locking\n6. **Template with invalid KDL syntax** - Validation on create/import\n7. **Unicode in template names** - Normalize to ASCII or allow?\n8. **Empty template directory** - Show helpful message\n\n## E2E Test Specification\n\n### Test: test_template_full_workflow\n```\nGIVEN a zjj-initialized repository\n  AND session 'my-session' exists with custom layout (3 panes)\nWHEN the user runs 'zjj template list --json'\nTHEN the system shall return built-in templates: minimal, standard, full, split, review\n\nAND WHEN the user runs 'zjj template create my-layout --from-current --json' (inside my-session)\nTHEN the system shall:\n  1. Capture current Zellij layout\n  2. Save to .zjj/templates/my-layout.kdl\n  3. Return JSON: {success: true, template: 'my-layout', path: '.zjj/templates/my-layout.kdl'}\n\nAND WHEN the user runs 'zjj template list --json' again\nTHEN 'my-layout' shall appear in the list with type: 'custom'\n\nAND WHEN the user runs 'zjj add new-session --template=my-layout --json'\nTHEN new-session shall use the my-layout template\n\nAND WHEN the user runs 'zjj template delete standard --json'\nTHEN the system shall return error: {code: 'CANNOT_DELETE_BUILTIN', ...}\n\nAND WHEN the user runs 'zjj template delete my-layout --force --json'\nTHEN the template shall be removed and zjj template list shall not include it\n```","status":"in_progress","priority":2,"issue_type":"feature","created_at":"2026-01-19T04:40:35.751203069Z","created_by":"lewis","updated_at":"2026-02-02T04:20:30.775553405Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"zjj-t2up","title":"P3: WebSocket-based real-time progress updates","description":"## Vision\nEnable external tools (IDE plugins, web dashboards) to get real-time updates.\n\n## EARS Requirements\n\n### Ubiquitous Requirements\n- **[U1]** The system shall provide 'zjj serve' for WebSocket server\n- **[U2]** The system shall emit events for all state changes\n- **[U3]** The system shall support multiple client connections\n\n### Event-Driven Requirements\n- **[E1]** When session created, emit {type: 'session_created', ...}\n- **[E2]** When session status changes, emit {type: 'status_changed', ...}\n- **[E3]** When client connects, send current state snapshot\n\n### Optional Feature Requirements\n- **[O1]** Where --port=<N> provided, use custom port\n- **[O2]** Where --auth-token provided, require authentication\n\n## Edge Cases\n1. Client disconnects mid-stream - Clean up\n2. Very high event rate - Throttling\n3. Large state snapshot - Pagination\n4. Multiple servers - Prevent conflicts\n\n## E2E Test: test_websocket_server\n```\nGIVEN 'zjj serve --port=9999' running\nWHEN WebSocket client connects to ws://localhost:9999\nTHEN receive state snapshot\nWHEN 'zjj add new-session' runs\nTHEN connected client receives {type: 'session_created', session: 'new-session'}\n```","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-19T04:40:42.547016619Z","created_by":"lewis","updated_at":"2026-01-19T05:07:39.632272673Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"zjj-uxqs.20","title":"Refactor zjj-core remaining files (6 files) into modular structure","description":"# CONTEXT BLOCK\n\n**Files:** 6 remaining zjj-core files needing modularization\n**Target:** Extract each file into 2-3 focused modules\n\n## SPECIFICATION\n\n**Postconditions:**\n- All zjj-core files under 250 lines\n- Functionality preserved\n- Tests pass\n- moon run :quick passes","notes":"Completed: 1/6 files (beads.rs: 1982→1247 lines across 5 modules). All tests pass. Ready to merge. Remaining: introspection.rs (1602), session_state.rs (1248), hints.rs (1202), config.rs (981), types.rs (867).","status":"in_progress","priority":2,"issue_type":"task","created_at":"2026-01-16T19:10:24.291888733Z","created_by":"lewis","updated_at":"2026-01-29T11:38:20.231804888Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"zjj-vpit","title":"Synchronize AGENTS.md and CLAUDE.md in Scaffolding","description":"CONTEXT: AGENTS.md and CLAUDE.md often contain the same core instructions for different AI interfaces.\nGOAL: Ensure zjj init scaffolds them as identical clones from a single source of truth to prevent drift.\nEARS: When 'zjj init' is invoked, the system shall write the same core instruction template to both AGENTS.md and CLAUDE.md.\nACCEPTANCE:\n1. Single source of truth for AI instructions in zjj-core.\n2. Both files are generated with identical content.\n3. Tests verify content parity.","status":"in_progress","priority":1,"issue_type":"task","owner":"priorlewis43@gmail.com","created_at":"2026-01-29T10:25:51.899970580Z","created_by":"Lewis Prior","updated_at":"2026-02-02T04:20:31.200408796Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["ai-safety","init","scaffold"]}
{"id":"zjj-w8zz","title":"Complete Replacement Epic: Rewrite all commands from scratch","description":"> CONTEXT BLOCK:\n> - **Files:** All command implementations in `crates/zjj/src/commands/*/mod.rs`\n> - **The Smell:** \"Commands use old architecture. Need complete rewrite using JSONL input, ResponseEnvelope, observable operations, state tracking.\"\n\n> SPECIFICATION BLOCK:\n> 1. **EARS:**\n>     - When any command executes, system shall accept JSONL input ONLY.\n>     - When any command succeeds, system shall return ResponseEnvelope with next actions.\n>     - When any command fails, system shall return ResponseEnvelope with error and fixes.\n>     - When any operation executes, system shall record before/after state and side effects.\n> 2. **DbC:**\n>     - **Preconditions:** ResponseEnvelope exists, StateTracker exists, next action builders exist, observable wrapper exists\n>     - **Postconditions:** ALL old command code deleted, all new commands use JSONL input, all use ResponseEnvelope, all wrapped in observable operations\n> 3. **Replacement Order:**\n>     - Phase 1 (P0): init, add, list (simple commands - complete rewrites)\n>     - Phase 2 (P1): status, sync, diff, remove, focus (core workflow - complete rewrites)\n>     - Phase 3 (P2): All remaining commands (merge, abandon, exec, etc. - complete rewrites)\n> 4. **Pattern:**\n>     ```rust\n>     // NEW CODE (not migration):\n>     pub async fn run_from_request(request: InputRequest) -> Result<()> {\n>         let before = state_tracker.snapshot_before().await?;\n>         let start = Instant::now();\n>         \n>         // Execute command\n>         let result = execute_add(&request).await?;\n>         \n>         let duration_ms = start.elapsed().as_millis() as u64;\n>         let after = state_tracker.snapshot_after().await?;\n>         let side_effects = detect_side_effects(&before, &after);\n>         \n>         let output = AddResponseObservable {\n>             success: true,\n>             name: result.name.clone(),\n>             operation: OperationResult { before, after, side_effects, duration_ms },\n>             next: next_actions_after_add(&result.name),\n>             undo: format!(\"zjj remove {}\", result.name),\n>         };\n>         \n>         println!(\"{}\", serde_json::to_string_pretty(&output)?);\n>         Ok(())\n>     }\n>     ```\n> 5. **Verification:**\n>     - All old command implementations deleted\n>     - All new commands accept JSONL input only\n>     - All return ResponseEnvelope\n>     - All wrapped in observable operations\n>     - next field populated for success\n>     - fixes field populated for errors\n>     - Tests verify complete replacement\n> 6. **Invariants/Variants:**\n>     - **WILL DO:** Complete rewrite of all commands, delete old implementations, JSONL-only input, observable operations\n>     - **WON'T DO:** Won't keep old code, won't migrate incrementally, won't maintain backward compatibility\n> 7. **Review as AI:**\n>     - **Coverage:** Complete replacement of all command implementations\n>     - **Context:** Depends on ResponseEnvelope (zjj-6lpj), StateTracker (zjj-9svt), Observable Wrapper (zjj-apt5)","status":"in_progress","priority":1,"issue_type":"epic","owner":"priorlewis43@gmail.com","created_at":"2026-01-25T07:22:30.457242017Z","created_by":"Lewis Prior","updated_at":"2026-02-04T16:16:20.337271984Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"zjj-w8zz","depends_on_id":"zjj-6lpj","type":"blocks","created_at":"2026-02-02T04:20:04Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"zjj-w8zz","depends_on_id":"zjj-9svt","type":"blocks","created_at":"2026-02-02T04:20:04Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"zjj-w8zz","depends_on_id":"zjj-apt5","type":"blocks","created_at":"2026-02-02T04:20:04Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"zjj-wm9y","title":"agent-1-clone-reduction","status":"open","priority":2,"issue_type":"task","owner":"priorlewis43@gmail.com","created_at":"2026-01-29T11:22:41.049237093Z","created_by":"Lewis Prior","updated_at":"2026-01-29T11:22:41.049237093Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"zjj-wmef","title":"Complete zjj-uxqs Phase 2: Refactor 41 remaining large files (19,751 lines)","notes":"Partial progress made: Fixed pre-existing syntax errors in askama.rs (extra closing brace) and batch/mod.rs (misplaced ? after map_err). Created characterization tests for hooks.rs refactoring. Epic scope (41 files, 19,751 lines) too large for single session - recommend splitting into sub-tasks for parallel agents.","status":"in_progress","priority":3,"issue_type":"epic","created_at":"2026-01-17T20:20:56.312489983Z","created_by":"lewis","updated_at":"2026-02-04T18:44:27.557846617Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"zjj-wx1l","title":"Scaffold Core Rule Documentation","description":"CONTEXT: Projects need explicit rules for error handling, build systems, and language standards.\nGOAL: Expand 'zjj init' to scaffold core documentation files: 01_ERROR_HANDLING.md, 02_MOON_BUILD.md, and 05_RUST_STANDARDS.md.\nEARS: When 'zjj init' is invoked, the system shall create a docs/ directory and populate it with core rule templates.\nACCEPTANCE:\n1. docs/01_ERROR_HANDLING.md (Zero Policy) created.\n2. docs/02_MOON_BUILD.md (Moon rules) created.\n3. docs/05_RUST_STANDARDS.md (Rust standards) created.","status":"open","priority":2,"issue_type":"task","owner":"priorlewis43@gmail.com","created_at":"2026-01-29T10:25:56.927299980Z","created_by":"Lewis Prior","updated_at":"2026-01-29T10:25:56.927299980Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["docs","init","scaffold"]}
{"id":"zjj-wxy0","title":"zjj-workspace-corruption-recovery: Workspace repair and validation","description":"# zjj-workspace-corruption-recovery: Implement workspace repair and validation\n\n## Problem\nAgent 19 hit \"JJ workspace internal state mismatch\" preventing push. With parallel agents, workspace corruption becomes common. Need repair and validation tools.\n\n## Solution\nAdd `zjj repair <workspace>` and `zjj validate <workspace>` commands to detect and fix corrupted JJ state.\n\n## Requirements\n\n### Ubiquitous\n- THE SYSTEM SHALL detect JJ workspace corruption patterns\n- THE SYSTEM SHALL auto-fix recoverable corruption issues\n- THE SYSTEM SHALL provide clear error messages for unrecoverable issues\n\n### Event-Driven\n- WHEN user runs `zjj validate <workspace>`, THE SYSTEM SHALL check workspace integrity\n- WHEN corruption is detected, THE SYSTEM SHALL attempt automatic repair\n- WHEN repair succeeds, THE SYSTEM SHALL confirm workspace is healthy\n\n### Unwanted\n- IF workspace is unrecoverable, THE SYSTEM SHALL NOT silently fail, BECAUSE users need explicit guidance\n- IF repair would lose data, THE SYSTEM SHALL NOT proceed, BECAUSE data safety is critical\n\n## Contracts\n\n### Preconditions\n- Workspace directory exists\n- JJ binary is available\n- User has write permissions\n\n### Postconditions\n- Workspace passes all integrity checks OR\n- Detailed report explains why workspace is unrecoverable\n- Audit log records repair attempts\n\n### Invariants\n- Validation never modifies workspace\n- Repair creates backup before changes\n- Original state is recoverable\n\n## Implementation\nAdd to zjj-core/src/commands/:\n- `repair.rs` - Repair command with corruption detection\n- `validate.rs` - Validation command with health checks\n- Common corruption patterns: state mismatch, missing refs, broken index\n- Auto-fix strategies for each pattern\n- Better JJ error message parser\n\n## Acceptance Tests\n- Happy path: Valid workspace passes validation\n- Error path: Corrupted workspace detected and repaired\n- Edge case: Unrecoverable corruption handled gracefully\n- Edge case: Repair with backup restoration\n\n## Estimate\n4hr","status":"in_progress","priority":0,"issue_type":"feature","created_at":"2026-02-02T04:27:50.008126204Z","created_by":"lewis","updated_at":"2026-02-03T02:22:43.133000404Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"zjj-y5vh.1","title":"Add Askama dependency and template infrastructure","description":"CONTEXT: We need a type-safe templating engine for scaffolding.\nGOAL: Add 'askama' to zjj-core and setup the templates directory.\nEARS: The system shall provide a central registry for Askama templates.\nACCEPTANCE:\n1. Cargo.toml updated with askama.\n2. templates/ directory initialized in zjj-core.\n3. Smoke test template compiles.","status":"in_progress","priority":1,"issue_type":"task","owner":"priorlewis43@gmail.com","created_at":"2026-01-29T10:49:02.519153495Z","created_by":"Lewis Prior","updated_at":"2026-01-29T10:57:04.148648668Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["askama","infra"],"dependencies":[{"issue_id":"zjj-y5vh.1","depends_on_id":"zjj-y5vh","type":"parent-child","created_at":"2026-02-02T04:20:04Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"zjj-y5vh.2","title":"Implement Synchronized AI Instructions Scaffolding","description":"CONTEXT: AGENTS.md and CLAUDE.md must remain in parity.\nGOAL: Create an Askama template for AI instructions and a function to scaffold both files.\nEARS: When 'zjj init' is called, the system shall generate identical AGENTS.md and CLAUDE.md from a single template.\nACCEPTANCE:\n1. Askama template for AI instructions created.\n2. Function ensures byte-for-byte parity between files.\n3. Tests verify generation from template.","status":"in_progress","priority":1,"issue_type":"task","owner":"priorlewis43@gmail.com","created_at":"2026-01-29T10:49:07.545866053Z","created_by":"Lewis Prior","updated_at":"2026-01-29T11:00:57.129000592Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["ai-safety","scaffold"],"dependencies":[{"issue_id":"zjj-y5vh.2","depends_on_id":"zjj-y5vh","type":"parent-child","created_at":"2026-02-02T04:20:04Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"zjj-y5vh.6","title":"Orchestrate Comprehensive Scaffolding in 'zjj init'","description":"CONTEXT: All scaffolding must be triggered by a single command.\nGOAL: Update the 'init' command to call all individual scaffolding functions.\nEARS: When the user invokes 'zjj init', the system shall perform a complete repository stand-up.\nACCEPTANCE:\n1. All sub-scaffolding tasks integrated.\n2. Idempotency verified (won't overwrite existing files).\n3. Success status reflects all components created.","status":"in_progress","priority":1,"issue_type":"task","owner":"priorlewis43@gmail.com","created_at":"2026-01-29T10:49:27.653271201Z","created_by":"Lewis Prior","updated_at":"2026-02-04T16:17:22.189683314Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["init","integration"],"dependencies":[{"issue_id":"zjj-y5vh.6","depends_on_id":"zjj-y5vh","type":"parent-child","created_at":"2026-02-02T04:20:04Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"zjj-y9i1","title":"Implement LockManager and complete lock/unlock commands","description":"Agent 7 created lock command skeleton but missing:\n- LockManager.lock_with_ttl() method in zjj-core\n- LockManager integration in SessionDb.lock_manager()  \n- Full lock/unlock workflow with TTL support\n- JSON output types (LockOutputJson, UnlockOutputJson)\n\nCode exists in workspace archive but needs coordination layer.","status":"open","priority":2,"issue_type":"feature","owner":"priorlewis43@gmail.com","created_at":"2026-01-29T12:22:43.743230837Z","created_by":"Lewis Prior","updated_at":"2026-01-29T12:22:43.743230837Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"zjj-y9jr","title":"Remove .cursorrules from workspace discoverability","description":"CONTEXT: .cursorrules is currently being created in spawned workspaces to guide AI agents.\nGOAL: Rip out .cursorrules creation and its associated constant from crates/zjj/src/commands/spawn/mod.rs.\nRATIONALE: We want to consolidate agent instructions into other formats (like .ai-instructions.md) or let the orchestrator handle it differently.","status":"open","priority":2,"issue_type":"task","owner":"priorlewis43@gmail.com","created_at":"2026-01-29T10:03:20.251076926Z","created_by":"Lewis Prior","updated_at":"2026-01-29T10:03:20.251076926Z","source_repo":".","compaction_level":0,"original_size":0,"labels":["ai-safety","refactor","spawn"]}
{"id":"zjj-ykzv","title":"Epic: ZJJ v0.3.0 Roadmap - Workflow Completion","description":"## Vision: ZJJ as the Single AI Interface\n\n**ZJJ is the ONLY tool AI agents need for:**\n- Workspace isolation (JJ workspaces)\n- Version control (JJ commits, rebases, merges)\n- Terminal UI (Zellij tabs, panes, layouts)\n- Issue tracking (Beads integration)\n\n**AI agents should NEVER need to learn:**\n- Raw JJ commands (use zjj describe, zjj abandon, zjj bookmark, etc.)\n- Raw Zellij commands (use zjj focus, zjj pane, zjj template, etc.)\n- Raw Beads commands (use zjj link, zjj unlink, etc.)\n\n---\n\n## Roadmap Beads\n\n### P0 - Critical (Must Have) - BLOCKED BY\n- **zjj-8nwv**: `zjj attach` - External terminal access\n- **zjj-1fs1**: `zjj clean` - Workspace cleanup\n- **zjj-zibs**: `zjj exec --all` - Parallel operations\n\n### P1 - High Value\n- **zjj-b5h5**: `zjj merge` - Complete workflow cycle\n- **zjj-qgdz**: Positional args for add-batch\n- **zjj-7vx3**: Progress streaming\n- **zjj-wzwv**: `zjj clone` - Workspace duplication\n\n### P2 - JJ Wrappers (AI doesn't need jj commands)\n- **zjj-3i9h**: `zjj describe` - Edit commit messages\n- **zjj-w13y**: `zjj abandon` - Discard changes\n- **zjj-r1gq**: `zjj recover` - Operation log restore\n- **zjj-r8kq**: `zjj bookmark` - Branch management\n\n### P2 - Zellij Wrappers (AI doesn't need zellij commands)\n- **zjj-nzhd**: `zjj rename` - Tab renaming\n- **zjj-nzj1**: `zjj workspace exec` - Run in specific workspace\n- **zjj-ndzl**: Zellij query-tab for accurate status\n\n### P2 - Beads Wrappers (AI doesn't need bd commands)\n- **zjj-imz7**: `zjj link/unlink` - Bead association\n- **zjj-rmjy**: `zjj template` - Layout management\n\n### P3 - Future\n- **zjj-2zjx**: Enhanced TUI dashboard\n- **zjj-ne2b**: `zjj resolve` - Conflict resolution UI\n- **zjj-t2up**: WebSocket real-time events\n- **zjj-7qzd**: Multi-repository support\n- **zjj-fdx0**: `zjj pane focus` - Pane navigation\n- **zjj-41es**: `zjj pane resize` - Pane sizing\n- **zjj-4v9w**: `zjj pane float` - Floating toggle\n\n---\n\n## Command Surface After v0.3.0\n\n### Session Lifecycle\n```\nzjj init              # Initialize\nzjj add <name>        # Create session\nzjj clone <from> <to> # Duplicate session\nzjj list              # List sessions\nzjj status            # Show status\nzjj focus <name>      # Switch to session\nzjj attach <name>     # Attach from external terminal\nzjj sync [name]       # Rebase on main\nzjj merge <name>      # Complete workflow: squash+rebase+push+remove\nzjj remove <name>     # Remove session\nzjj clean             # Remove stale sessions\nzjj exec --all <cmd>  # Run command in all workspaces\n```\n\n### Version Control (JJ wrappers)\n```\nzjj describe [session] -m <msg>  # Edit commit message\nzjj abandon [session]            # Discard changes\nzjj recover [session]            # Restore from op log\nzjj bookmark list/create/delete  # Branch management\nzjj diff [session]               # Show changes\n```\n\n### Terminal UI (Zellij wrappers)\n```\nzjj rename <session> <name>      # Rename tab\nzjj template list/create/use     # Layout management\nzjj pane focus/resize/float      # Pane control\nzjj dashboard                    # Interactive TUI\n```\n\n### Issue Tracking (Beads wrappers)\n```\nzjj link <session> <bead-id>     # Associate bead\nzjj unlink <session>             # Remove association\n```\n\n### System\n```\nzjj doctor                       # Health checks\nzjj config                       # Configuration\nzjj context/prime                # AI context\nzjj introspect/query             # Programmatic queries\n```\n\n---\n\n## Research Document\nFull analysis: .tdd15-cache/ZJJ_COMPREHENSIVE_RESEARCH.md","notes":"Work deferred to concrete implementation beads (zjj-nye9, zjj-rh9f). Epic tracks roadmap, not implementation.","status":"in_progress","priority":1,"issue_type":"epic","created_at":"2026-01-19T04:40:35.070226885Z","created_by":"lewis","updated_at":"2026-02-04T18:24:31.070431618Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"zjj-z82r","title":"Remove test infrastructure dead code or implement tests","description":"Multiple test mocks show dead_code warnings:\n\ndone/bead.rs:\n- MockBeadRepository and methods (add_bead, get_status)\n\ndone/executor.rs:\n- MockJjExecutor and methods (new, expect, calls, fail_next)\n\ndone/filesystem.rs:\n- InMemoryFileSystem and methods\n- FsError::InvalidUtf8 variant\n\nDecision needed:\n1. Implement tests using these mocks\n2. Remove unused test infrastructure\n3. Mark with #[cfg(test)] properly\n\nThese were created during parallel agent development but never used.","status":"open","priority":3,"issue_type":"tech-debt","created_at":"2026-02-03T04:22:56.192426841Z","created_by":"lewis","updated_at":"2026-02-03T04:22:56.192426841Z","source_repo":".","compaction_level":0,"original_size":0}
