$schema: "https://moonrepo.dev/schemas/tasks.json"

# Project: {{ project_name }}
# CI tasks require --force flag for absolute verification

fileGroups:
  sources:
    - "src/**/*"
    - "Cargo.toml"
  tests:
    - "tests/**/*"

tasks:
  quick:
    command: "cargo"
    args:
      - "check"
      - "--workspace"
    inputs:
      - "@group(sources)"
    options:
      cache: true
      runInCI: false

  ci:
    command: "cargo"
    args:
      - "test"
      - "--workspace"
      - "--all-features"
    inputs:
      - "@group(sources)"
      - "@group(tests)"
    options:
      cache: true
      runInCI: true
      # NOTE: Always run with --force flag to bypass cache for absolute verification
      # Usage: moon run :ci --force

  build:
    command: "cargo"
    args:
      - "build"
      - "--release"
    outputs:
      - "target/release/{{ project_name }}"
    inputs:
      - "@group(sources)"
    options:
      cache: true
      runInCI: true

  install:
    command: "cargo"
    args:
      - "install"
      - "--path"
      - "."
      - "--root"
      - "$HOME/.local"
    deps:
      - "~:build"
    outputs:
      - "~/.local/bin/{{ project_name }}"
    options:
      cache: false
      runInCI: false
