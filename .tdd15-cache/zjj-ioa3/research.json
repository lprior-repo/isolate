{
  "bead_id": "zjj-ioa3",
  "title": "P0-2e: Wrap SyncOutput in SchemaEnvelope",
  "type": "task",
  "priority": "P0",
  "status": "IN_PROGRESS",
  "complexity": "SIMPLE",
  "description": "Wrap SyncOutput JSON response in SchemaEnvelope for version tracking and schema evolution. The smell: SyncOutput lacks envelope. No version tracking for schema evolution.",
  "files_affected": [
    "crates/zjj/src/commands/sync.rs - output_json() and sync functions",
    "crates/zjj/src/json_output.rs - SyncOutput struct definition"
  ],
  "key_dependencies": {
    "existing_types": [
      "zjj_core::json::SchemaEnvelope - Already exists in crates/zjj-core/src/json.rs",
      "SyncOutput - Already defined in json_output.rs",
      "OutputFormat - Already used in sync.rs"
    ]
  },
  "integration_points": {
    "json_module": "SchemaEnvelope::new() in json.rs line 360-369",
    "sync_command": "sync.rs sync_session_with_options() at line 48-50",
    "output_format": "Check options.format.is_json() before wrapping",
    "related_output": "Also check sync_all_with_options() for similar wrapping"
  },
  "test_requirements": [
    "test_sync_json_has_envelope - Verify output has $schema field",
    "test_sync_rebase_result_wrapped - Verify rebase success/conflict is wrapped",
    "test_sync_already_up_to_date_wrapped - Verify 'already up-to-date' response is wrapped"
  ],
  "implementation_sketch": {
    "step_1": "In sync.rs sync_session_with_options(), after successful sync, create SyncOutput",
    "step_2": "Wrap with: SchemaEnvelope::new(\"sync-response\", \"single\", sync_output)",
    "step_3": "Serialize and print JSON",
    "step_4": "Handle sync_all_with_options() similarly",
    "edge_cases": [
      "Rebase conflicts (error wrapped in envelope)",
      "Already up-to-date (success wrapped)",
      "Session not found (NotFound error wrapped)"
    ]
  },
  "research_notes": "Similar to zjj-jakw but for sync command. SyncOutput is defined in json_output.rs. Need to check both sync_session_with_options() and sync_all_with_options() functions for all output points.",
  "estimated_effort": "LOW - Similar complexity to zjj-jakw, ~35 minutes",
  "phase_routing": "SIMPLE - Skip phases 1-3, start at phase 4 (RED tests)"
}
