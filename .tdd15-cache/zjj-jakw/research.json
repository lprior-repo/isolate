{
  "bead_id": "zjj-jakw",
  "title": "P0-2d: Wrap StatusOutput in SchemaEnvelope",
  "type": "task",
  "priority": "P0",
  "status": "IN_PROGRESS",
  "complexity": "SIMPLE",
  "description": "Wrap StatusOutput JSON response in SchemaEnvelope with schema_type='single' for AI-native schema validation. The smell: StatusOutput serialized without envelope. Missing $schema field.",
  "files_affected": [
    "crates/zjj/src/commands/status.rs - output_json() function in status command"
  ],
  "key_dependencies": {
    "existing_types": [
      "zjj_core::json::SchemaEnvelope - Already exists in crates/zjj-core/src/json.rs",
      "SessionStatusInfo - Already defined in status.rs",
      "OutputFormat - Already used in status.rs"
    ]
  },
  "integration_points": {
    "json_module": "SchemaEnvelope::new() in json.rs line 360-369",
    "status_command": "status.rs run() and run_once() functions",
    "output_format": "Check format.is_json() before wrapping"
  },
  "test_requirements": [
    "test_status_json_has_envelope - Verify output has $schema field",
    "test_status_schema_type_single - Verify schema_type='single' for object response",
    "test_status_envelope_structure - Verify envelope wraps entire response"
  ],
  "implementation_sketch": {
    "step_1": "In status.rs output_json(), create SessionStatusInfo struct with session data",
    "step_2": "Wrap with: SchemaEnvelope::new(\"status-response\", \"single\", status_info)",
    "step_3": "Serialize envelope: serde_json::to_string(&envelope)?",
    "step_4": "Print JSON output",
    "edge_cases": [
      "Session not found error (wrap error in envelope)",
      "Malformed workspace (graceful error wrapping)"
    ]
  },
  "research_notes": "This is a straightforward wrapping task. The SchemaEnvelope type is already defined with clear API. Just need to identify where StatusOutput is created, wrap it, and add tests. No schema changes needed.",
  "estimated_effort": "LOW - Simple wrapping task, ~30 minutes",
  "phase_routing": "SIMPLE - Skip phases 1-3, start at phase 4 (RED tests)"
}
