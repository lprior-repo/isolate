{
  "bead_id": "zjj-gv3f",
  "title": "EPIC: State Tracking Infrastructure",
  "type": "epic",
  "priority": "P0",
  "status": "IN_PROGRESS",
  "complexity": "COMPLEX",
  "description": "Build complete state tracking system for AI brain observability. This epic covers state snapshots, state diffs, and before/after tracking for all operations.",
  "key_dependencies": [
    "zjj-fl0d: Define complete CUE schema for zjj_protocol (BLOCKS this epic)",
    "zjj-txqd: History database with pattern detection (BLOCKS this epic)"
  ],
  "blocked_by_epics": [
    "zjj-i9u5: Session lock manager for agent coordination (P1)",
    "zjj-mitf: Agent registry with heartbeat tracking (P1)",
    "zjj-pxvy: Checkpoint/restore system for state rollback (P1)"
  ],
  "files_affected": [
    "crates/zjj-core/src/session_state.rs - Core state tracking infrastructure",
    "crates/zjj-core/src/json.rs - Schema envelope for state responses",
    "crates/zjj/src/commands/status.rs - Status command with state snapshots",
    "crates/zjj/src/commands/sync.rs - Sync command with before/after state",
    "crates/zjj/src/db.rs - Session database for state persistence"
  ],
  "architecture_notes": {
    "state_layer": "Build immutable state snapshot structures in zjj-core",
    "persistence": "SQLite through session_state.rs for durability",
    "schema": "Use SchemaEnvelope for all JSON state responses",
    "integration": "All commands must track state before/after operations"
  },
  "child_tasks": [
    "zjj-jakw: P0-2d: Wrap StatusOutput in SchemaEnvelope",
    "zjj-ioa3: P0-2e: Wrap SyncOutput in SchemaEnvelope",
    "zjj-05ut: SchemaEnvelope wrapper missing on most JSON outputs"
  ],
  "research_notes": "This is a foundational epic that enables AI-native observability. All child tasks must wrap outputs in SchemaEnvelope for schema validation. The epic is blocked by schema definition work (zjj-fl0d) and history database (zjj-txqd). Most child tasks are ready to work immediately as they depend on SchemaEnvelope which already exists in json.rs.",
  "estimated_effort": "VERY_HIGH - Epic spanning multiple phases and 5+ dependent tasks",
  "phase_routing": "Skip phases 1-3 for child tasks; this is orchestration/coordination"
}
